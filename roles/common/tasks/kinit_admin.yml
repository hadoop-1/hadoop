---

- name: delay 30 seconds
  pause:
      seconds: 30
  when: delays|default(True)==True

- name: kinit admin
  shell: |
      sudo su - 'TEST014\admin' -c 'for i in hdnode1 hdnode2 hdnode3;do ssh -qxn $i "sudo cp -p /etc/security/keytabs/*.keytab .";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1 hdnode2 hdnode3;do ssh -qxn $i "sudo chown admin@TEST014.ORG *.keytab";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1 hdnode2 hdnode3;do ssh -qxn $i "kinit -kt hdfs.headless.keytab hdfs-hadoopdev@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt yarn-ats.hbase-regionserver.service.keytab yarn-ats-hbase/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2; do ssh -qxn $i "kinit -kt yarn-ats.hbase-regionserver.service.keytab yarn-ats-hbase/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt yarn-ats.hbase-regionserver.service.keytab yarn-ats-hbase/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1 hdnode2 hdnode3; do ssh -qxn $i "kinit -kt yarn-ats.hbase-client.headless.keytab yarn-ats-hadoopdev@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt yarn-ats.hbase-master.service.keytab yarn-ats-hbase/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2; do ssh -qxn $i "kinit -kt yarn-ats.hbase-master.service.keytab yarn-ats-hbase/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt yarn-ats.hbase-master.service.keytab yarn-ats-hbase/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt zk.service.keytab zookeeper/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2; do ssh -qxn $i "kinit -kt zk.service.keytab zookeeper/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt zk.service.keytab zookeeper/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt ams-monitor.keytab amsmon/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2; do ssh -qxn $i "kinit -kt ams-monitor.keytab amsmon/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt ams-monitor.keytab amsmon/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt dn.service.keytab dn/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt dn.service.keytab dn/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt jhs.service.keytab jhs/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt jn.service.keytab jn/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2; do ssh -qxn $i "kinit -kt jn.service.keytab jn/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt jn.service.keytab jn/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt nm.service.keytab nm/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt nm.service.keytab nm/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt smokeuser.headless.keytab ambari-qa-hadoopdev@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2; do ssh -qxn $i "kinit -kt smokeuser.headless.keytab ambari-qa-hadoopdev@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt smokeuser.headless.keytab ambari-qa-hadoopdev@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt spnego.service.keytab HTTP/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2; do ssh -qxn $i "kinit -kt spnego.service.keytab HTTP/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt spnego.service.keytab HTTP/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1; do ssh -qxn $i "kinit -kt yarn.service.keytab yarn/hdnode1.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2; do ssh -qxn $i "kinit -kt yarn.service.keytab yarn/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1;do ssh -qxn $i "kinit -kt ambari.server.keytab ambari-server-hadoopdev@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2;do ssh -qxn $i "kinit -kt activity-analyzer.headless.keytab activity_analyzer/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2;do ssh -qxn $i "kinit -kt activity-explorer.headless.keytab activity_explorer/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode2;do ssh -qxn $i "kinit -kt rm.service.keytab rm/hdnode2.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt ams.collector.keytab amshbase/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt ams-hbase.master.keytab amshbase/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt ams-hbase.regionserver.keytab amshbase/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode3; do ssh -qxn $i "kinit -kt ams-zk.service.keytab amszk/hdnode3.test014.org@TEST014.ORG";done'
      sudo su - 'TEST014\admin' -c 'for i in hdnode1 hdnode2 hdnode3; do ssh -qxn $i "hdfs dfs -ls /";done'
      